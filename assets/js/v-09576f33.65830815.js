"use strict";(self.webpackChunkweiboqianduan=self.webpackChunkweiboqianduan||[]).push([[4722],{2538:(n,e,l)=>{l.r(e),l.d(e,{data:()=>a});const a={key:"v-09576f33",path:"/Utils/%E7%94%A8docker%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE.html",title:"用docker部署一个项目",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"用docker部署一个项目",slug:"用docker部署一个项目-1",children:[]},{level:2,title:"安装",slug:"安装",children:[]},{level:2,title:"image 文件",slug:"image-文件",children:[]},{level:2,title:"容器文件",slug:"容器文件",children:[]},{level:2,title:"Dockerfile 文件",slug:"dockerfile-文件",children:[]},{level:2,title:"十、实例：制作自己的 Docker 容器",slug:"十、实例-制作自己的-docker-容器",children:[{level:3,title:"编写 Dockerfile 文件",slug:"编写-dockerfile-文件",children:[]},{level:3,title:"10.2 创建 image 文件",slug:"_10-2-创建-image-文件",children:[]},{level:3,title:"10.3 生成容器",slug:"_10-3-生成容器",children:[]},{level:3,title:"10.4 CMD 命令",slug:"_10-4-cmd-命令",children:[]},{level:3,title:"10.5 发布 image 文件",slug:"_10-5-发布-image-文件",children:[]}]},{level:2,title:"引用",slug:"引用",children:[]},{level:2,title:"今日图 - 有的时候我的代码会像这样",slug:"今日图-有的时候我的代码会像这样",children:[]}],filePathRelative:"Utils/用docker部署一个项目.md",git:{updatedTime:1630569898e3}}},3841:(n,e,l)=>{l.r(e),l.d(e,{default:()=>le});var a=l(6252),s=l(4070);const r=(0,a._)("h1",{id:"用docker部署一个项目",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#用docker部署一个项目","aria-hidden":"true"},"#"),(0,a.Uk)(" 用docker部署一个项目")],-1),c=(0,a._)("h2",{id:"用docker部署一个项目-1",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#用docker部署一个项目-1","aria-hidden":"true"},"#"),(0,a.Uk)(" 用docker部署一个项目")],-1),o=(0,a._)("h2",{id:"安装",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#安装","aria-hidden":"true"},"#"),(0,a.Uk)(" 安装")],-1),u=(0,a._)("p",null,[(0,a.Uk)("mac下 "),(0,a._)("code",null,"brew cask install docker")],-1),i=(0,a._)("p",null,"安装完成后，运行下面的命令，验证是否安装成功。",-1),_=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker version\n"),(0,a._)("span",{class:"token comment"},"# 或者"),(0,a.Uk)("\n$ docker info\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br")])])],-1),t=(0,a._)("h2",{id:"image-文件",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#image-文件","aria-hidden":"true"},"#"),(0,a.Uk)(" image 文件")],-1),k=(0,a._)("p",null,"**Docker 把应用程序及其依赖，打包在 image 文件里面。**只有通过这个文件，才能生成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。",-1),d=(0,a._)("p",null,"image 是二进制文件。实际开发中，一个 image 文件往往通过继承另一个 image 文件，加上一些个性化设置而生成。举例来说，你可以在 Ubuntu 的 image 基础上，往里面加入 Apache 服务器，形成你的 image。",-1),m=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a._)("span",{class:"token comment"},"# 列出本机的所有 image 文件。"),(0,a.Uk)("\n$ docker image "),(0,a._)("span",{class:"token function"},"ls"),(0,a.Uk)("\n\n"),(0,a._)("span",{class:"token comment"},"# 删除 image 文件"),(0,a.Uk)("\n$ docker image "),(0,a._)("span",{class:"token function"},"rm"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("imageName"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br")])])],-1),b=(0,a._)("h2",{id:"容器文件",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#容器文件","aria-hidden":"true"},"#"),(0,a.Uk)(" 容器文件")],-1),p=(0,a._)("p",null,"**image 文件生成的容器实例，本身也是一个文件，称为容器文件。**也就是说，一旦容器生成，就会同时存在两个文件： image 文件和容器文件。而且关闭容器并不会删除容器文件，只是容器停止运行而已。",-1),g=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a._)("span",{class:"token comment"},"# 列出本机正在运行的容器"),(0,a.Uk)("\n$ docker container "),(0,a._)("span",{class:"token function"},"ls"),(0,a.Uk)("\n\n"),(0,a._)("span",{class:"token comment"},"# 列出本机所有容器，包括终止运行的容器"),(0,a.Uk)("\n$ docker container "),(0,a._)("span",{class:"token function"},"ls"),(0,a.Uk)(" --all\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br")])])],-1),h=(0,a._)("p",null,[(0,a.Uk)("上面命令的输出结果之中，包括容器的 ID。很多地方都需要提供这个 ID，比如上一节终止容器运行的"),(0,a._)("code",null,"docker container kill"),(0,a.Uk)("命令。")],-1),U=(0,a.Uk)("终止运行的容器文件，依然会占据硬盘空间，可以使用"),f={href:"https://docs.docker.com/engine/reference/commandline/container_rm/",target:"_blank",rel:"noopener noreferrer"},v=(0,a._)("code",null,"docker container rm",-1),D=(0,a.Uk)("命令删除。"),x=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker container "),(0,a._)("span",{class:"token function"},"rm"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("containerID"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br")])])],-1),q=(0,a._)("p",null,[(0,a.Uk)("运行上面的命令之后，再使用"),(0,a._)("code",null,"docker container ls --all"),(0,a.Uk)("命令，就会发现被删除的容器文件已经消失了。")],-1),$=(0,a._)("h2",{id:"dockerfile-文件",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#dockerfile-文件","aria-hidden":"true"},"#"),(0,a.Uk)(" Dockerfile 文件")],-1),y=(0,a._)("p",null,"学会使用 image 文件以后，接下来的问题就是，如何可以生成 image 文件？如果你要推广自己的软件，势必要自己制作 image 文件。",-1),R=(0,a._)("p",null,"这就需要用到 Dockerfile 文件。它是一个文本文件，用来配置 image。Docker 根据 该文件生成二进制的 image 文件。",-1),w=(0,a._)("p",null,"下面通过一个实例，演示如何编写 Dockerfile 文件。",-1),C=(0,a._)("h2",{id:"十、实例-制作自己的-docker-容器",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#十、实例-制作自己的-docker-容器","aria-hidden":"true"},"#"),(0,a.Uk)(" 十、实例：制作自己的 Docker 容器")],-1),E=(0,a.Uk)("下面我以 "),M={href:"http://www.ruanyifeng.com/blog/2017/08/koa.html",target:"_blank",rel:"noopener noreferrer"},N=(0,a.Uk)("koa-demos"),O=(0,a.Uk)(" 项目为例，介绍怎么写 Dockerfile 文件，实现让用户在 Docker 容器里面运行 Koa 框架。"),I=(0,a.Uk)("作为准备工作，请先"),W={href:"https://github.com/ruanyf/koa-demos/archive/master.zip",target:"_blank",rel:"noopener noreferrer"},Y=(0,a.Uk)("下载源码"),j=(0,a.Uk)("。"),A=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ "),(0,a._)("span",{class:"token function"},"git"),(0,a.Uk)(" clone https://github.com/ruanyf/koa-demos.git\n$ "),(0,a._)("span",{class:"token builtin class-name"},"cd"),(0,a.Uk)(" koa-demos\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),B=(0,a._)("h3",{id:"编写-dockerfile-文件",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#编写-dockerfile-文件","aria-hidden":"true"},"#"),(0,a.Uk)(" 编写 Dockerfile 文件")],-1),X=(0,a.Uk)("首先，在项目的根目录下，新建一个文本文件"),P=(0,a._)("code",null,".dockerignore",-1),S=(0,a.Uk)("，写入下面的"),K={href:"https://github.com/ruanyf/koa-demos/blob/master/.dockerignore",target:"_blank",rel:"noopener noreferrer"},Z=(0,a.Uk)("内容"),F=(0,a.Uk)("。"),T=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,".git\nnode_modules\nnpm-debug.log\n")]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br")])])],-1),G=(0,a._)("p",null,"上面代码表示，这三个路径要排除，不要打包进入 image 文件。如果你没有路径要排除，这个文件可以不新建。",-1),J=(0,a.Uk)("然后，在项目的根目录下，新建一个文本文件 Dockerfile，写入下面的"),z={href:"https://github.com/ruanyf/koa-demos/blob/master/Dockerfile",target:"_blank",rel:"noopener noreferrer"},H=(0,a.Uk)("内容"),Q=(0,a.Uk)("。"),L=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("FROM node:8.4\nCOPY "),(0,a._)("span",{class:"token builtin class-name"},"."),(0,a.Uk)(" /app\nWORKDIR /app\nRUN "),(0,a._)("span",{class:"token function"},"npm"),(0,a.Uk)(),(0,a._)("span",{class:"token function"},"install"),(0,a.Uk)(" --registry"),(0,a._)("span",{class:"token operator"},"="),(0,a.Uk)("https://registry.npm.taobao.org\nEXPOSE "),(0,a._)("span",{class:"token number"},"3000"),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br")])])],-1),V=(0,a._)("p",null,"上面代码一共五行，含义如下。",-1),nn=(0,a._)("blockquote",null,[(0,a._)("ul",null,[(0,a._)("li",null,[(0,a._)("code",null,"FROM node:8.4"),(0,a.Uk)("：该 image 文件继承官方的 node image，冒号表示标签，这里标签是"),(0,a._)("code",null,"8.4"),(0,a.Uk)("，即8.4版本的 node。")]),(0,a._)("li",null,[(0,a._)("code",null,"COPY . /app"),(0,a.Uk)("：将当前目录下的所有文件（除了"),(0,a._)("code",null,".dockerignore"),(0,a.Uk)("排除的路径），都拷贝进入 image 文件的"),(0,a._)("code",null,"/app"),(0,a.Uk)("目录。")]),(0,a._)("li",null,[(0,a._)("code",null,"WORKDIR /app"),(0,a.Uk)("：指定接下来的工作路径为"),(0,a._)("code",null,"/app"),(0,a.Uk)("。")]),(0,a._)("li",null,[(0,a._)("code",null,"RUN npm install"),(0,a.Uk)("：在"),(0,a._)("code",null,"/app"),(0,a.Uk)("目录下，运行"),(0,a._)("code",null,"npm install"),(0,a.Uk)("命令安装依赖。注意，安装后所有的依赖，都将打包进入 image 文件。")]),(0,a._)("li",null,[(0,a._)("code",null,"EXPOSE 3000"),(0,a.Uk)("：将容器 3000 端口暴露出来， 允许外部连接这个端口。")])])],-1),en=(0,a._)("h3",{id:"_10-2-创建-image-文件",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_10-2-创建-image-文件","aria-hidden":"true"},"#"),(0,a.Uk)(" 10.2 创建 image 文件")],-1),ln=(0,a._)("p",null,[(0,a.Uk)("有了 Dockerfile 文件以后，就可以使用"),(0,a._)("code",null,"docker image build"),(0,a.Uk)("命令创建 image 文件了。")],-1),an=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker image build -t koa-demo "),(0,a._)("span",{class:"token builtin class-name"},"."),(0,a.Uk)("\n"),(0,a._)("span",{class:"token comment"},"# 或者"),(0,a.Uk)("\n$ docker image build -t koa-demo:0.0.1 "),(0,a._)("span",{class:"token builtin class-name"},"."),(0,a.Uk)("\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br")])])],-1),sn=(0,a._)("p",null,[(0,a.Uk)("上面代码中，"),(0,a._)("code",null,"-t"),(0,a.Uk)("参数用来指定 image 文件的名字，后面还可以用冒号指定标签。如果不指定，默认的标签就是"),(0,a._)("code",null,"latest"),(0,a.Uk)("。最后的那个点表示 Dockerfile 文件所在的路径，上例是当前路径，所以是一个点。")],-1),rn=(0,a._)("p",null,[(0,a.Uk)("如果运行成功，就可以看到新生成的 image 文件"),(0,a._)("code",null,"koa-demo"),(0,a.Uk)("了。")],-1),cn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker image "),(0,a._)("span",{class:"token function"},"ls"),(0,a.Uk)("\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),on=(0,a._)("h3",{id:"_10-3-生成容器",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_10-3-生成容器","aria-hidden":"true"},"#"),(0,a.Uk)(" 10.3 生成容器")],-1),un=(0,a._)("p",null,[(0,a._)("code",null,"docker container run"),(0,a.Uk)("命令会从 image 文件生成容器。")],-1),_n=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker container run -p "),(0,a._)("span",{class:"token number"},"8000"),(0,a.Uk)(":3000 -it koa-demo /bin/bash\n"),(0,a._)("span",{class:"token comment"},"# 或者"),(0,a.Uk)("\n$ docker container run -p "),(0,a._)("span",{class:"token number"},"8000"),(0,a.Uk)(":3000 -it koa-demo:0.0.1 /bin/bash\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br")])])],-1),tn=(0,a._)("p",null,"上面命令的各个参数含义如下：",-1),kn=(0,a._)("blockquote",null,[(0,a._)("ul",null,[(0,a._)("li",null,[(0,a._)("code",null,"-p"),(0,a.Uk)("参数：容器的 3000 端口映射到本机的 8000 端口。")]),(0,a._)("li",null,[(0,a._)("code",null,"-it"),(0,a.Uk)("参数：容器的 Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器。")]),(0,a._)("li",null,[(0,a._)("code",null,"koa-demo:0.0.1"),(0,a.Uk)("：image 文件的名字（如果有标签，还需要提供标签，默认是 latest 标签）。")]),(0,a._)("li",null,[(0,a._)("code",null,"/bin/bash"),(0,a.Uk)("：容器启动以后，内部第一个执行的命令。这里是启动 Bash，保证用户可以使用 Shell。")])])],-1),dn=(0,a._)("p",null,"如果一切正常，运行上面的命令以后，就会返回一个命令行提示符。",-1),mn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("root@66d80f4aaf1e:/app"),(0,a._)("span",{class:"token comment"},"#"),(0,a.Uk)("\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),bn=(0,a._)("p",null,"这表示你已经在容器里面了，返回的提示符就是容器内部的 Shell 提示符。执行下面的命令。",-1),pn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("root@66d80f4aaf1e:/app"),(0,a._)("span",{class:"token comment"},"# node demos/01.js"),(0,a.Uk)("\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),gn=(0,a.Uk)('这时，Koa 框架已经运行起来了。打开本机的浏览器，访问 http://127.0.0.1:8000，网页显示"Not Found"，这是因为这个 '),hn={href:"https://github.com/ruanyf/koa-demos/blob/master/demos/01.js",target:"_blank",rel:"noopener noreferrer"},Un=(0,a.Uk)("demo"),fn=(0,a.Uk)(" 没有写路由。"),vn=(0,a._)("p",null,"这个例子中，Node 进程运行在 Docker 容器的虚拟环境里面，进程接触到的文件系统和网络接口都是虚拟的，与本机的文件系统和网络接口是隔离的，因此需要定义容器与物理机的端口映射（map）。",-1),Dn=(0,a._)("p",null,[(0,a.Uk)("现在，在容器的命令行，按下 Ctrl + c 停止 Node 进程，然后按下 Ctrl + d （或者输入 exit）退出容器。此外，也可以用"),(0,a._)("code",null,"docker container kill"),(0,a.Uk)("终止容器运行。")],-1),xn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a._)("span",{class:"token comment"},"# 在本机的另一个终端窗口，查出容器的 ID"),(0,a.Uk)("\n$ docker container "),(0,a._)("span",{class:"token function"},"ls"),(0,a.Uk)("\n\n"),(0,a._)("span",{class:"token comment"},"# 停止指定的容器运行"),(0,a.Uk)("\n$ docker container "),(0,a._)("span",{class:"token function"},"kill"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("containerID"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br")])])],-1),qn=(0,a._)("p",null,"容器停止运行之后，并不会消失，用下面的命令删除容器文件。",-1),$n=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a._)("span",{class:"token comment"},"# 查出容器的 ID"),(0,a.Uk)("\n$ docker container "),(0,a._)("span",{class:"token function"},"ls"),(0,a.Uk)(" --all\n\n"),(0,a._)("span",{class:"token comment"},"# 删除指定的容器文件"),(0,a.Uk)("\n$ docker container "),(0,a._)("span",{class:"token function"},"rm"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("containerID"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br")])])],-1),yn=(0,a._)("p",null,[(0,a.Uk)("也可以使用"),(0,a._)("code",null,"docker container run"),(0,a.Uk)("命令的"),(0,a._)("code",null,"--rm"),(0,a.Uk)("参数，在容器终止运行后自动删除容器文件。")],-1),Rn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker container run --rm -p "),(0,a._)("span",{class:"token number"},"8000"),(0,a.Uk)(":3000 -it koa-demo /bin/bash\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),wn=(0,a._)("h3",{id:"_10-4-cmd-命令",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_10-4-cmd-命令","aria-hidden":"true"},"#"),(0,a.Uk)(" 10.4 CMD 命令")],-1),Cn=(0,a._)("p",null,[(0,a.Uk)("上一节的例子里面，容器启动以后，需要手动输入命令"),(0,a._)("code",null,"node demos/01.js"),(0,a.Uk)("。我们可以把这个命令写在 Dockerfile 里面，这样容器启动以后，这个命令就已经执行了，不用再手动输入了。")],-1),En=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("FROM node:8.4\nCOPY "),(0,a._)("span",{class:"token builtin class-name"},"."),(0,a.Uk)(" /app\nWORKDIR /app\nRUN "),(0,a._)("span",{class:"token function"},"npm"),(0,a.Uk)(),(0,a._)("span",{class:"token function"},"install"),(0,a.Uk)(" --registry"),(0,a._)("span",{class:"token operator"},"="),(0,a.Uk)("https://registry.npm.taobao.org\nEXPOSE "),(0,a._)("span",{class:"token number"},"3000"),(0,a.Uk)("\nCMD node demos/01.js\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"5"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"6"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"7"),(0,a._)("br")])])],-1),Mn=(0,a._)("p",null,[(0,a.Uk)("上面的 Dockerfile 里面，多了最后一行"),(0,a._)("code",null,"CMD node demos/01.js"),(0,a.Uk)("，它表示容器启动后自动执行"),(0,a._)("code",null,"node demos/01.js"),(0,a.Uk)("。")],-1),Nn=(0,a._)("p",null,[(0,a.Uk)("你可能会问，"),(0,a._)("code",null,"RUN"),(0,a.Uk)("命令与"),(0,a._)("code",null,"CMD"),(0,a.Uk)("命令的区别在哪里？简单说，"),(0,a._)("code",null,"RUN"),(0,a.Uk)("命令在 image 文件的构建阶段执行，执行结果都会打包进入 image 文件；"),(0,a._)("code",null,"CMD"),(0,a.Uk)("命令则是在容器启动后执行。另外，一个 Dockerfile 可以包含多个"),(0,a._)("code",null,"RUN"),(0,a.Uk)("命令，但是只能有一个"),(0,a._)("code",null,"CMD"),(0,a.Uk)("命令。")],-1),On=(0,a._)("p",null,[(0,a.Uk)("注意，指定了"),(0,a._)("code",null,"CMD"),(0,a.Uk)("命令以后，"),(0,a._)("code",null,"docker container run"),(0,a.Uk)("命令就不能附加命令了（比如前面的"),(0,a._)("code",null,"/bin/bash"),(0,a.Uk)("），否则它会覆盖"),(0,a._)("code",null,"CMD"),(0,a.Uk)("命令。现在，启动容器可以使用下面的命令。")],-1),In=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker container run --rm -p "),(0,a._)("span",{class:"token number"},"8000"),(0,a.Uk)(":3000 -it koa-demo:0.0.1\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),Wn=(0,a._)("h3",{id:"_10-5-发布-image-文件",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#_10-5-发布-image-文件","aria-hidden":"true"},"#"),(0,a.Uk)(" 10.5 发布 image 文件")],-1),Yn=(0,a._)("p",null,"容器运行成功后，就确认了 image 文件的有效性。这时，我们就可以考虑把 image 文件分享到网上，让其他人使用。",-1),jn=(0,a.Uk)("首先，去 "),An={href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"},Bn=(0,a.Uk)("hub.docker.com"),Xn=(0,a.Uk)(" 或 "),Pn={href:"https://cloud.docker.com/",target:"_blank",rel:"noopener noreferrer"},Sn=(0,a.Uk)("cloud.docker.com"),Kn=(0,a.Uk)(" 注册一个账户。然后，用下面的命令登录。"),Zn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,"$ docker login\n\n")]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),Fn=(0,a._)("p",null,"接着，为本地的 image 标注用户名和版本。",-1),Tn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker image tag "),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("imageName"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)(),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("username"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("/"),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("repository"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)(":"),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("tag"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n"),(0,a._)("span",{class:"token comment"},"# 实例"),(0,a.Uk)("\n$ docker image tag koa-demos:0.0.1 ruanyf/koa-demos:0.0.1\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"3"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"4"),(0,a._)("br")])])],-1),Gn=(0,a._)("p",null,"也可以不标注用户名，重新构建一下 image 文件。",-1),Jn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker image build -t "),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("username"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("/"),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("repository"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)(":"),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("tag"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)(),(0,a._)("span",{class:"token builtin class-name"},"."),(0,a.Uk)("\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),zn=(0,a._)("p",null,"最后，发布 image 文件。",-1),Hn=(0,a._)("blockquote",null,[(0,a._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a._)("pre",{class:"language-bash"},[(0,a._)("code",null,[(0,a.Uk)("$ docker image push "),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("username"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("/"),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("repository"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)(":"),(0,a._)("span",{class:"token punctuation"},"["),(0,a.Uk)("tag"),(0,a._)("span",{class:"token punctuation"},"]"),(0,a.Uk)("\n\n")])]),(0,a._)("div",{class:"line-numbers"},[(0,a._)("span",{class:"line-number"},"1"),(0,a._)("br"),(0,a._)("span",{class:"line-number"},"2"),(0,a._)("br")])])],-1),Qn=(0,a._)("p",null,"发布成功以后，登录 hub.docker.com，就可以看到已经发布的 image 文件。",-1),Ln=(0,a._)("h2",{id:"引用",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#引用","aria-hidden":"true"},"#"),(0,a.Uk)(" 引用")],-1),Vn=(0,a._)("ul",null,[(0,a._)("li",null,"http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html")],-1),ne=(0,a._)("h2",{id:"今日图-有的时候我的代码会像这样",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#今日图-有的时候我的代码会像这样","aria-hidden":"true"},"#"),(0,a.Uk)(" 今日图 - 有的时候我的代码会像这样")],-1),ee=(0,a._)("p",null,[(0,a._)("img",{src:s,alt:"16c3616c85ea4e5e.png"})],-1),le={render:function(n,e){const l=(0,a.up)("OutboundLink");return(0,a.wg)(),(0,a.iD)(a.HY,null,[r,c,o,u,i,_,t,k,d,m,b,p,g,h,(0,a._)("p",null,[U,(0,a._)("a",f,[v,(0,a.Wm)(l)]),D]),x,q,$,y,R,w,C,(0,a._)("p",null,[E,(0,a._)("a",M,[N,(0,a.Wm)(l)]),O]),(0,a._)("p",null,[I,(0,a._)("a",W,[Y,(0,a.Wm)(l)]),j]),A,B,(0,a._)("p",null,[X,P,S,(0,a._)("a",K,[Z,(0,a.Wm)(l)]),F]),T,G,(0,a._)("p",null,[J,(0,a._)("a",z,[H,(0,a.Wm)(l)]),Q]),L,V,nn,en,ln,an,sn,rn,cn,on,un,_n,tn,kn,dn,mn,bn,pn,(0,a._)("p",null,[gn,(0,a._)("a",hn,[Un,(0,a.Wm)(l)]),fn]),vn,Dn,xn,qn,$n,yn,Rn,wn,Cn,En,Mn,Nn,On,In,Wn,Yn,(0,a._)("p",null,[jn,(0,a._)("a",An,[Bn,(0,a.Wm)(l)]),Xn,(0,a._)("a",Pn,[Sn,(0,a.Wm)(l)]),Kn]),Zn,Fn,Tn,Gn,Jn,zn,Hn,Qn,Ln,Vn,ne,ee],64)}}},4070:n=>{n.exports="data:image/png;base64,ZXhwb3J0IGRlZmF1bHQgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gKyAiYjEwZDAyMTI3MTExNGU0OTQ3ODViZmI1NGYwMTJmZjgucG5nIjs="}}]);